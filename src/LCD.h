#ifndef LCD_H
#define LCD_H

#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>

// 0: Configuration:
#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 32
#define OLED_RESET    -1 
#define SCREEN_ADDRESS 0x3C 
#define VOLUME_BAR_WIDTH 5
#define VOLUME_BAR_HEIGHT_MAX 30

// bitmaps at https://javl.github.io/image2cpp/
static const unsigned char heartIcon [] PROGMEM = {
  0x00, 0x66, 0xFF, 0xFF, 0xFF, 0x7E, 0x3C, 0x18
};

static const unsigned char SpotifyIcon[] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xff, 0xff, 0xff, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x01, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x00, 0x00, 0x00, 0x0f, 0xff, 0xff, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0, 0x00, 0x00, 0x7f, 0xff, 0xff, 0xff, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x00, 0x03, 0xff, 0xff, 0xf8, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x7f, 0xff, 0xff, 0xff, 0xff, 0x00, 0x0f, 0xff, 0xe0, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x1f, 0xff, 0xff, 0xc0, 0x3f, 0xff, 0xe0, 0x00, 0x3f, 0xff, 0xff, 0xff, 
	0xe0, 0x00, 0x00, 0x00, 0x0f, 0xff, 0xf0, 0x7f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
	0xff, 0xfc, 0x00, 0x03, 0xff, 0xf8, 0xff, 0xff, 0xff, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 
	0xff, 0xff, 0xff, 0xff, 0xfc, 0xff, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 
	0xff, 0xff, 0xff, 0xfc, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x07, 
	0xff, 0xff, 0xfc, 0x7f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x07, 0xff, 
	0xff, 0xf8, 0x3f, 0xff, 0xff, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 0xff, 0xff, 0xff, 0xff, 
	0xf0, 0x0f, 0xff, 0xff, 0xc0, 0x1f, 0xff, 0xff, 0xff, 0x00, 0x00, 0x0f, 0xff, 0xff, 0xff, 0xc0, 
	0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x03, 0xff, 0xff, 0xff, 0x00, 0x00, 
	0x7f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x00, 0x00, 0x0f, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0, 0x00, 0x00, 0x00, 0x7f, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 
	0xff, 0xff, 0xff, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00
};


enum LCDzone {      //           ( X  | Y )
    TEXT_ZONE  = 0, // top right (118 x 9  px)
    VOLUM_ZONE = 1, // left      (10  x 32 px)
    IMAGE_ZONE = 2  // the rest of the screen (118x23)
};


class LcdDriver {
private:
    Adafruit_SSD1306 display;
    int sdaPin;
    int sclPin;

    /**
     * @brief compute the offset in x and y of a given zone
     * @param zone TEXT_ZONE, VOLUM_ZONE or IMAGE_ZONE
     * @param xOff (int) the x value to add to correspond in the selected zone
     * @param yOff (int) the y value to add to correspond in the selected zone
     */
    void getZoneOffset(LCDzone zone, int *xOff, int *yOff);

public:
    /** 
     * @brief create the object
     * @param sda (int) the SDA pin
     * @param scl (int) the SCL pin
     **/
    LcdDriver(int sda, int scl);    // construtor

    /**
     * @brief initialise the LCD
     */
    bool begin();   // init
    
    /**
     * @brief clear all the LCD display
     */
    void clear();   // clear the screen 
    
    /**
     * @brief update the LCD - MANDATORY to apply change(s)
     */
    void update();  // print all change(s) done 
    
    /**
     * @brief draw the given image by "bitmap" on the LCD (don't care about the LCD decomposition in 3 zones)
     * @param x (int) the x value of the beginning of the image  
     * @param y (int) the y value of the beginning of the image
     * @param bitmap (const unsigned char*) the 
     * @param w (int) the width  of the image
     * @param h (int) the height of the image
     */
    void drawImage(int x, int y, const unsigned char* bitmap, int w, int h);    // basic function
    
    /**
     * @brief print the given text on the LCD (don't care about the LCD decomposition in 3 zones)
     * @param x (int) the x value of the beginning of the text  
     * @param y (int) the y value of the beginning of the text
     * @param text (const char*) the text to print
     */
    void printText(int x, int y, const char* text);                             // basic function

    /**
     * @brief draw the volume bar in this zone with the specified percentage
     * @param zone TEXT_ZONE, VOLUM_ZONE or IMAGE_ZONE
     * @param percentage (int) from 0 to 100 
     */
    void drawVolumeBar(LCDzone zone, int percentage);                                       // print the frame for the volume bar
    
    /**
     * @brief print a given text in the image zone
     * NB: used only for debugging, watch out to the lenght: line break in the volume bar
     * @param zone TEXT_ZONE, VOLUM_ZONE or IMAGE_ZONE
     * @param localX (int) start x value of the text, in the zone (don't care about the LCD decomposition in 3 zones)
     * @param localY (int) start y value of the image, in the zone (don't care about the LCD decomposition in 3 zones)
     * @param bitmap (const unsigned char*) an array which contains the bitmap to display (see LCD.h)
     * @param width  (int) the width  of the bitmap to display
     * @param height (int) the height of the bitmap to display
     */
    void printTextInZone(LCDzone zone, int x, int y, const char* text);                     // print text  in the textual zone 
    
    /**
     * @brief draw the image send as "bitmap" in the image zone (maximum 118x23 px)
     * @param zone TEXT_ZONE, VOLUM_ZONE or IMAGE_ZONE
     * @param localX (int) start x value of the image, in the zone (don't care about the LCD decomposition in 3 zones)
     * @param localY (int) start y value of the image, in the zone (don't care about the LCD decomposition in 3 zones)
     * @param bitmap (const unsigned char*) an array which contains the bitmap to display (see LCD.h)
     * @param width  (int) the width  of the bitmap to display
     * @param height (int) the height of the bitmap to display
     */
    void drawImageInZone(LCDzone zone, int x, int y, const unsigned char* bitmap, int width, int height);

    /**
     * @brief clear the zone (text, volume or image) selected
     * @param zone TEXT_ZONE, VOLUM_ZONE or IMAGE_ZONE
     */
    void clearZone(LCDzone zone);   // clear only one selected zone
};

#endif